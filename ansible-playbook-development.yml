# This playbook installs apps and packages needed for general development
- hosts: localhost
  pre_tasks:
    - name: Stow dotfiles for ack
      command: stow ack
      changed_when: false
    - name: Stow dotfiles for Git
      command: stow git
      changed_when: false
    - name: Stow dotfiles for Neovim
      command: stow neovim
      changed_when: false
    - name: Stow dotfiles for Oh My Zsh
      command: stow zsh
      changed_when: false
  tasks:
    - name: Tap antibody repository
      homebrew_tap:
        name: getantibody/tap
        state: present
    - name: Install development packages with Homebrew
      homebrew:
        name: ack,antibody,bat,coreutils,fd,fdupes,ffmpeg,git,go,grep,gron,hub,imagemagick,jq,neovim,nmap,nnn,node,pipes-sh,python,shellcheck,thefuck,tidy-html5,tldr,tokei,tree,uncrustify,watch,zsh
        state: present
    - name: Install nvim plugins
      command: nvim --headless +GoUpdateBinaries +PlugUpdate +PlugUpgrade +qall
      changed_when: false
    - name: Install vim-plug
      command: curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
      changed_when: false
    - name: Install Node.js packages
      command: npm install -g js-beautify prettydiff typescript typescript-formatter
    - name: Install Oh My Zsh
      shell: sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
      register: result
      changed_when: result.stdout is not search("You already have Oh My Zsh installed.")
      failed_when: result.rc != 0 and result.stdout is not search("You already have Oh My Zsh installed.")
