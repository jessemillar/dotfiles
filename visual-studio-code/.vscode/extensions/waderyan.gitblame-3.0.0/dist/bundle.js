module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=12)}([function(t,e,r){"use strict";function n(t){return!!t.useClass}function o(t){return null!=t.useValue}function i(t){return!!t.useToken}function s(t){return!!t.useFactory}function a(t){return"string"==typeof t||"symbol"==typeof t}r.r(e);var c=function(){function t(t){this.parent=t,this._registry=new Map}return t.prototype.register=function(t,e,r){if(void 0===r&&(r={singleton:!1}),r.singleton&&(o(e)||s(e)))throw"Cannot use {singleton: true} with ValueProviders or FactoryProviders";return this._registry.set(t,{provider:e,options:r}),this},t.prototype.registerType=function(t,e){return a(e)?this.register(t,{useToken:e}):this.register(t,{useClass:e})},t.prototype.registerInstance=function(t,e){return this.register(t,{useValue:e})},t.prototype.registerSingleton=function(t,e){if(a(t)){if(a(e))return this.register(t,{useToken:e},{singleton:!0});if(e)return this.register(t,{useClass:e},{singleton:!0});throw'Cannot register a type name as a singleton without a "to" token'}var r=t;return e&&!a(e)&&(r=e),this.register(t,{useClass:r},{singleton:!0})},t.prototype.resolve=function(t){var e=this.getRegistration(t);if(!e&&a(t))throw"Attempted to resolve unregistered dependency token: "+t.toString();return e?o(e.provider)?e.provider.useValue:i(e.provider)?e.options.singleton?e.instance||(e.instance=this.resolve(e.provider.useToken)):this.resolve(e.provider.useToken):n(e.provider)?e.options.singleton?e.instance||(e.instance=this.construct(e.provider.useClass)):this.construct(e.provider.useClass):s(e.provider)?e.provider.useFactory(this):this.construct(e.provider):this.construct(t)},t.prototype.isRegistered=function(t){return this._registry.has(t)},t.prototype.reset=function(){this._registry.clear()},t.prototype.createChildContainer=function(){return new t(this)},t.prototype.getRegistration=function(t){return this.isRegistered(t)?this._registry.get(t):this.parent?this.parent.getRegistration(t):null},t.prototype.construct=function(t){var e=this;if(0===t.length)return new t;var r=u.get(t);if(!r||0===r.length)throw"TypeInfo not known for "+t;var n=r.map(function(t){return e.resolve(t)});return new(t.bind.apply(t,[void 0].concat(n)))},t}(),u=new Map,l=new c,f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var h="injectionTokens";function p(t){var e=Reflect.getMetadata("design:paramtypes",t)||[],r=Reflect.getOwnMetadata(h,t)||{};return Object.keys(r).forEach(function(t){e[+t]=r[t]}),e}function m(){return function(t){u.set(t,p(t))}}function d(){return function(t){m()(t),l.registerSingleton(t)}}function y(){return function(t){var e=p(t);return function(r){function n(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return r.apply(this,n.concat(e.slice(n.length).map(function(e,r){try{return l.resolve(e)}catch(e){var o=r+n.length,i=(t.toString().match(/constructor\(([\w, ]+)\)/)||[])[1],s=void 0===i?null:i;throw"Cannot inject the dependency "+(s?s.split(",")[o]:"#"+o)+" of "+t.name+" constructor. "+e}})))||this}return function(t,e){function r(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(n,r),n}(t)}}function g(t){return function(e,r,n){var o=Reflect.getOwnMetadata(h,e)||{};o[n]=t,Reflect.defineMetadata(h,o,e)}}function v(t){return void 0===t&&(t=[]),function(e){return t.forEach(function(t){var e=t.token,r=t.options,n=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}(t,["token","options"]);return l.register(e,n,r)}),e}}function w(t){var e;return function(r){return null==e&&(e=t(r)),e}}function _(t,e,r,n){var o,i;return void 0===n&&(n=!0),function(s){var a=t(s);return n&&i===a||(o=(i=a)?s.resolve(e):s.resolve(r)),o}}if(r.d(e,"container",function(){return b}),r.d(e,"injectable",function(){return m}),r.d(e,"singleton",function(){return d}),r.d(e,"autoInjectable",function(){return y}),r.d(e,"inject",function(){return g}),r.d(e,"registry",function(){return v}),r.d(e,"instanceCachingFactory",function(){return w}),r.d(e,"predicateAwareClassFactory",function(){return _}),r.d(e,"isClassProvider",function(){return n}),r.d(e,"isValueProvider",function(){return o}),r.d(e,"isTokenProvider",function(){return i}),r.d(e,"isFactoryProvider",function(){return s}),r.d(e,"isNormalToken",function(){return a}),"undefined"==typeof Reflect||!Reflect.getMetadata)throw"tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.";var b=l},function(t,e){t.exports=require("vscode")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(5);e.blankBlameInfo=function(){return{commits:{},lines:{}}},e.blankCommitInfo=function(t=!1){const e={author:{mail:"",name:"",timestamp:0,tz:""},committer:{mail:"",name:"",timestamp:0,tz:""},filename:"",generated:!0,hash:n.HASH_NO_COMMIT_GIT,summary:""};return t&&delete e.generated,e},e.isBlankCommit=function(t){return t.hash===n.HASH_NO_COMMIT_GIT}},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const i=r(1),s=r(0),a=r(5),c=r(4);var u;!function(t){t.Info="info",t.Error="error",t.Command="command",t.Critical="critical"}(u||(u={}));let l=class{constructor(){this.outputChannel=i.window.createOutputChannel("Extension: gitblame")}logInfo(t){this.writeToLog(u.Info,t)}logCommand(t){this.writeToLog(u.Command,t)}logError(t){this.writeToLog(u.Error,t.toString())}logCritical(t,e){this.writeToLog(u.Critical,t.toString()),this.showErrorMessage(e)}timestamp(){const t=new Date;return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}dispose(){this.outputChannel.dispose()}async showErrorMessage(t){await i.window.showErrorMessage(t,a.TITLE_SHOW_LOG)===a.TITLE_SHOW_LOG&&this.outputChannel.show()}writeToLog(t,e){if(s.container.resolve(c.Property).get("logNonCritical")||t===u.Critical){const r=e.trim(),n=this.timestamp();this.outputChannel.appendLine(`[ ${n} | ${t} ] ${r}`)}}};l=n([s.singleton(),o("design:paramtypes",[])],l),e.ErrorHandler=l},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1);let i=class{get(t){return o.workspace.getConfiguration("gitblame").get(t)}};i=n([r(0).injectable()],i),e.Property=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HASH_NO_COMMIT_GIT="0000000000000000000000000000000000000000",e.GIT_COMMAND_IN_PATH="git",e.TITLE_VIEW_ONLINE="View",e.TITLE_SHOW_LOG="Show Log",e.FS_EVENT_TYPE_REMOVE="rename",e.FS_EVENT_TYPE_CHANGE="change"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(10),o=r(21),i=r(1),s=r(0),a=r(5),c=r(22),u=r(23),l=r(4),f=r(3);function h(){const t=i.extensions.getExtension("vscode.git");return t&&t.exports&&t.exports.git&&t.exports.git.path?t.exports.git.path:a.GIT_COMMAND_IN_PATH}e.getGitCommand=h,e.getOriginOfActiveFile=async function(){if(!c.validEditor(i.window.activeTextEditor))return"";const t=h(),e=i.window.activeTextEditor.document.fileName,r=o.dirname(e);return(await u.execute(t,["ls-remote","--get-url","origin"],{cwd:r})).trim()},e.getRemoteUrl=async function(){if(!c.validEditor(i.window.activeTextEditor))return"";const t=h(),e=i.window.activeTextEditor.document.fileName,r=o.dirname(e),n=await u.execute(t,["symbolic-ref","-q","--short","HEAD"],{cwd:r}),s=await u.execute(t,["config","--local","--get",`branch.${n.trim()}.remote`],{cwd:r});return(await u.execute(t,["config","--local","--get",`remote.${s.trim()}.url`],{cwd:r})).trim()},e.getWorkTree=async function(t){const e=o.dirname(t),r=h(),n={cwd:e},i=await u.execute(r,["rev-parse","--show-toplevel"],n);return""===i.trim()?"":o.normalize(i.trim())},e.spawnGitBlameStreamProcess=function(t){const e=[];e.push("blame"),s.container.resolve(l.Property).get("ignoreWhitespace")&&e.push("-w"),e.push("--incremental"),e.push("--"),e.push(t);const r=h(),i={cwd:o.dirname(t)};return s.container.resolve(f.ErrorHandler).logCommand(`${r} ${e.join(" ")}`),n.spawn(r,e,i)}},function(t,e){t.exports=require("url")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(0),o=r(18),i=r(4),s=r(19),a=r(2);class c{static toTextView(t){if(a.isBlankCommit(t))return n.container.resolve(i.Property).get("statusBarMessageNoCommit")||"Not Committed Yet";const e=c.normalizeCommitInfoTokens(t),r=n.container.resolve(i.Property).get("statusBarMessageFormat");return r?c.parseTokens(r,e):"No configured message format for gitblame"}static toDateText(t,e){const r=s.yearsBetween(t,e),n=s.monthsBetween(t,e),i=s.daysBetween(t,e),a=s.hoursBetween(t,e),c=s.minutesBetween(t,e);return r>=1?o.pluralText(r,"year","years")+" ago":n>=1?o.pluralText(n,"month","months")+" ago":i>=1?o.pluralText(i,"day","days")+" ago":a>=1?o.pluralText(a,"hour","hours")+" ago":c>=5?o.pluralText(c,"minute","minutes")+" ago":"right now"}static parseTokens(t,e){const r=new RegExp("\\$\\{(?<token>[a-z._-]{1,}),*(?<value>.*?)(?<modifier>(|\\|[a-z]+))\\}","gi");return"string"!=typeof t?"":t.replace(r,(...t)=>{const r=t[t.length-1],n=c.runKey(e,r);return c.modify(n,r.modifier)})}static runKey(t,e){const r=t[e.token];return r?r(e.value):e.token}static modify(t,e){return"|u"===e?t.toUpperCase():"|l"===e?t.toLowerCase():`${t}${e}`}static normalizeCommitInfoTokens(t){const e=new Date,r=new Date(1e3*t.author.timestamp),n=new Date(1e3*t.committer.timestamp),o=t=>()=>t.toString(),i=o(c.toDateText(e,r)),s=o(c.toDateText(e,n));return{"author.mail":o(t.author.mail),"author.name":o(t.author.name),"author.timestamp":o(t.author.timestamp),"author.tz":o(t.author.tz),"commit.hash":o(t.hash),"commit.hash_short":(e="7")=>{const r=e.toString();return t.hash.substr(0,parseInt(r,10))},"commit.summary":o(t.summary),"committer.mail":o(t.committer.mail),"committer.name":o(t.committer.name),"committer.timestamp":o(t.committer.timestamp),"committer.tz":o(t.committer.tz),"time.ago":i,"time.c_ago":s,"time.from":i,"time.c_from":s,"commit.filename":o("(commit.filename is deprecated)"),"time.custom":o(`${r.toUTCString()} (time.custom is deprecated)`),"time.c_custom":o(`${n.toUTCString()} (time.c_custom is deprecated)`)}}}e.TextDecorator=c},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const i=r(1),s=r(0),a=r(4),c=r(8),u=r(2);let l=class{constructor(){this.statusBarItem=i.window.createStatusBarItem(i.StatusBarAlignment.Left,s.container.resolve(a.Property).get("statusBarPositionPriority"))}clear(){this.setText("")}update(t){if(t&&!t.generated){const e=!u.isBlankCommit(t);this.setText(c.TextDecorator.toTextView(t),e)}else this.clear()}startProgress(){this.setText("$(sync~spin) Waiting for git blame response")}dispose(){this.statusBarItem.dispose()}setText(t,e=!1){this.statusBarItem.text=`$(git-commit) ${t}`.trim(),e?(this.statusBarItem.tooltip="git blame",this.statusBarItem.command="gitblame.quickInfo"):(this.statusBarItem.tooltip="git blame - No info about the current line",this.statusBarItem.command=""),this.statusBarItem.show()}};l=n([s.singleton(),o("design:paramtypes",[])],l),e.StatusBarView=l},function(t,e){t.exports=require("child_process")},function(t,e){t.exports=require("fs")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r(13);const n=r(1),o=r(0),i=r(14),s=r(3);e.activate=function(t){if(n.workspace.workspaceFolders){const e=o.container.resolve(s.ErrorHandler),r=o.container.resolve(i.GitExtension),a=n.commands.registerCommand("gitblame.quickInfo",r.showMessage,r),c=n.commands.registerCommand("gitblame.online",r.blameLink,r),u=n.commands.registerCommand("gitblame.addCommitHashToClipboard",r.copyHash,r),l=n.commands.registerCommand("gitblame.addToolUrlToClipboard",r.copyToolUrl,r);t.subscriptions.push(e,r,a,c,u,l)}}},function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r;!function(t){!function(e){var r="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=o(t);function o(t,e){return function(r,n){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:n}),e&&e(r,n)}}void 0===r.Reflect?r.Reflect=t:n=o(r.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",i="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!i&&!s,c={create:i?function(){return R(Object.create(null))}:s?function(){return R({__proto__:null})}:function(){return R({})},has:a?function(t,r){return e.call(t,r)}:function(t,e){return e in t},get:a?function(t,r){return e.call(t,r)?t[r]:void 0}:function(t,e){return t[e]}},u=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],r=function(){function t(t,e,r){this._index=0,this._keys=t,this._values=e,this._selector=r}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var r=this._find(t,!0);return this._values[r]=e,this},e.prototype.delete=function(e){var r=this._find(e,!1);if(r>=0){for(var n=this._keys.length,o=r+1;o<n;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new r(this._keys,this._values,n)},e.prototype.values=function(){return new r(this._keys,this._values,i)},e.prototype.entries=function(){return new r(this._keys,this._values,s)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function n(t,e){return t}function i(t,e){return e}function s(t,e){return[t,e]}}():Map,h=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new f}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}():Set,p=new(l||"function"!=typeof WeakMap?function(){var t=16,r=c.create(),n=o();return function(){function t(){this._key=o()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){var r=i(t,!0);return r[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=o()},t}();function o(){var t;do{t="@@WeakMap@@"+a()}while(c.has(r,t));return r[t]=!0,t}function i(t,r){if(!e.call(t,n)){if(!r)return;Object.defineProperty(t,n,{value:c.create()})}return t[n]}function s(t,e){for(var r=0;r<e;++r)t[r]=255*Math.random()|0;return t}function a(){var e=function(t){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t);return s(new Array(t),t)}(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var r="",n=0;n<t;++n){var o=e[n];4!==n&&6!==n&&8!==n||(r+="-"),o<16&&(r+="0"),r+=o.toString(16).toLowerCase()}return r}}():WeakMap);function m(t,e,r){var n=p.get(t);if(_(n)){if(!r)return;n=new f,p.set(t,n)}var o=n.get(e);if(_(o)){if(!r)return;o=new f,n.set(e,o)}return o}function d(t,e,r){var n=m(e,r,!1);return!_(n)&&!!n.has(t)}function y(t,e,r){var n=m(e,r,!1);if(!_(n))return n.get(t)}function g(t,e,r,n){var o=m(r,n,!0);o.set(t,e)}function v(t,e){var r=[],n=m(t,e,!1);if(_(n))return r;for(var i=n.keys(),s=function(t){var e=C(t,o);if(!j(e))throw new TypeError;var r=e.call(t);if(!T(r))throw new TypeError;return r}(i),a=0;;){var c=k(s);if(!c)return r.length=a,r;var u=c.value;try{r[a]=u}catch(t){try{M(s)}finally{throw t}}a++}}function w(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function _(t){return void 0===t}function b(t){return null===t}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function O(t,e){switch(w(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=3===e?"string":5===e?"number":"default",o=C(t,n);if(void 0!==o){var i=o.call(t,r);if(T(i))throw new TypeError;return i}return function(t,e){if("string"===e){var r=t.toString;if(j(r)){var n=r.call(t);if(!T(n))return n}var o=t.valueOf;if(j(o)){var n=o.call(t);if(!T(n))return n}}else{var o=t.valueOf;if(j(o)){var n=o.call(t);if(!T(n))return n}var i=t.toString;if(j(i)){var n=i.call(t);if(!T(n))return n}}throw new TypeError}(t,"default"===r?"number":r)}function P(t){var e=O(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function E(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function j(t){return"function"==typeof t}function x(t){return"function"==typeof t}function C(t,e){var r=t[e];if(null!=r){if(!j(r))throw new TypeError;return r}}function k(t){var e=t.next();return!e.done&&e}function M(t){var e=t.return;e&&e.call(t)}function I(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===u)return e;if(e!==u)return e;var r=t.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return e;var o=n.constructor;return"function"!=typeof o?e:o===t?e:o}function R(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,r,n){if(_(r)){if(!E(t))throw new TypeError;if(!x(e))throw new TypeError;return function(t,e){for(var r=t.length-1;r>=0;--r){var n=t[r],o=n(e);if(!_(o)&&!b(o)){if(!x(o))throw new TypeError;e=o}}return e}(t,e)}if(!E(t))throw new TypeError;if(!T(e))throw new TypeError;if(!T(n)&&!_(n)&&!b(n))throw new TypeError;return b(n)&&(n=void 0),r=P(r),function(t,e,r,n){for(var o=t.length-1;o>=0;--o){var i=t[o],s=i(e,r,n);if(!_(s)&&!b(s)){if(!T(s))throw new TypeError;n=s}}return n}(t,e,r,n)}),t("metadata",function(t,e){return function(r,n){if(!T(r))throw new TypeError;if(!_(n)&&!function(t){switch(w(t)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;g(t,e,r,n)}}),t("defineMetadata",function(t,e,r,n){if(!T(r))throw new TypeError;_(n)||(n=P(n));return g(t,e,r,n)}),t("hasMetadata",function(t,e,r){if(!T(e))throw new TypeError;_(r)||(r=P(r));return function t(e,r,n){var o=d(e,r,n);if(o)return!0;var i=I(r);if(!b(i))return t(e,i,n);return!1}(t,e,r)}),t("hasOwnMetadata",function(t,e,r){if(!T(e))throw new TypeError;_(r)||(r=P(r));return d(t,e,r)}),t("getMetadata",function(t,e,r){if(!T(e))throw new TypeError;_(r)||(r=P(r));return function t(e,r,n){var o=d(e,r,n);if(o)return y(e,r,n);var i=I(r);if(!b(i))return t(e,i,n);return}(t,e,r)}),t("getOwnMetadata",function(t,e,r){if(!T(e))throw new TypeError;_(r)||(r=P(r));return y(t,e,r)}),t("getMetadataKeys",function(t,e){if(!T(t))throw new TypeError;_(e)||(e=P(e));return function t(e,r){var n=v(e,r);var o=I(e);if(null===o)return n;var i=t(o,r);if(i.length<=0)return n;if(n.length<=0)return i;var s=new h;var a=[];for(var c=0,u=n;c<u.length;c++){var l=u[c],f=s.has(l);f||(s.add(l),a.push(l))}for(var p=0,m=i;p<m.length;p++){var l=m[p],f=s.has(l);f||(s.add(l),a.push(l))}return a}(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!T(t))throw new TypeError;_(e)||(e=P(e));return v(t,e)}),t("deleteMetadata",function(t,e,r){if(!T(e))throw new TypeError;_(r)||(r=P(r));var n=m(e,r,!1);if(_(n))return!1;if(!n.delete(t))return!1;if(n.size>0)return!0;var o=p.get(e);return o.delete(r),o.size>0||(p.delete(e),!0)})}(n)}()}(r||(r={}))},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const i=r(7),s=r(1),a=r(0),c=r(5),u=r(15),l=r(3),f=r(16),h=r(4),p=r(17),m=r(8),d=r(20),y=r(9),g=r(2),v=r(6),w=r(24),_=r(25);let b=class{constructor(t,e){this.blame=t,this.statusBarView=e,this.disposable=this.setupListeners(),this.init()}async blameLink(){const t=await this.getCommitInfo(),e=await this.getToolUrl(t);e?s.commands.executeCommand("vscode.open",e):s.window.showErrorMessage("Missing gitblame.commitUrl configuration value.")}async showMessage(){const t=await this.getCommitInfo();if(g.isBlankCommit(t))return void this.clearView();const e=a.container.resolve(h.Property).get("infoMessageFormat")||"",r=m.TextDecorator.normalizeCommitInfoTokens(t),n=m.TextDecorator.parseTokens(e,r),o=this.generateMessageActions(t);this.updateView(t);const i=await s.window.showInformationMessage(n,...await o);i&&i.takeAction()}async copyHash(){const t=await this.getCommitInfo();try{await s.env.clipboard.writeText(t.hash),s.window.showInformationMessage("Copied hash to clipboard")}catch(e){a.container.resolve(l.ErrorHandler).logCritical(e,`Unable to copy hash to clipboard. hash: ${t.hash}`)}}async copyToolUrl(){const t=await this.getCommitInfo(),e=await this.getToolUrl(t);if(e)try{await s.env.clipboard.writeText(e.toString()),s.window.showInformationMessage("Copied tool URL to clipboard")}catch(t){a.container.resolve(l.ErrorHandler).logCritical(t,`Unable to copy tool URL to clipboard. URL: ${e}`)}else s.window.showErrorMessage("Missing gitblame.commitUrl configuration value.")}defaultWebPath(t,e,r){const n=w.stripGitRemoteUrl(t);let o;try{o=new i.URL(`https://${n}`)}catch(t){return""}return`https://${o.hostname}${o.pathname}/${r?"commits":"commit"}/${e}`}projectNameFromOrigin(t){const e=/([a-zA-Z0-9_~%+.-]*?(\.git)?)$/.exec(t);return e?e[1].replace(".git",""):""}dispose(){this.disposable.dispose()}setupListeners(){const t=[];return s.window.onDidChangeActiveTextEditor(this.onTextEditorMove,this,t),s.window.onDidChangeTextEditorSelection(this.onTextEditorMove,this,t),s.workspace.onDidSaveTextDocument(this.onTextEditorMove,this,t),s.workspace.onDidCloseTextDocument(this.onCloseTextDocument,this,t),s.Disposable.from(...t)}init(){this.onTextEditorMove()}async onTextEditorMove(){const t=this.getCurrentActiveFilePosition(),e=await this.getCurrentLineInfo(),r=this.getCurrentActiveFilePosition();t!==r&&"no-file:-1"!==r||this.updateView(e)}getCurrentActiveFilePosition(){if(void 0===s.window.activeTextEditor)return"no-file:-1";const{document:t,selection:e}=s.window.activeTextEditor;return`${t.fileName}:${e.active.line}`}async onCloseTextDocument(t){this.blame.removeDocument(t)}async generateMessageActions(t){const e=await this.getToolUrl(t),r=[];if(e){const t=a.container.resolve(u.ActionableMessageItem);t.setTitle(c.TITLE_VIEW_ONLINE),t.setAction(()=>{s.commands.executeCommand("vscode.open",e)}),r.push(t)}return r}async getCommitInfo(){const t=await this.getCurrentLineInfo();return t.generated&&s.window.showErrorMessage("The current file and line can not be blamed."),t}async getToolUrl(t){if(g.isBlankCommit(t))return;const e=a.container.resolve(h.Property).get("inferCommitUrl"),r=v.getRemoteUrl(),n=a.container.resolve(h.Property).get("commitUrl")||"",o=await v.getOriginOfActiveFile(),i=this.projectNameFromOrigin(o),c=w.stripGitRemoteUrl(await r),u=m.TextDecorator.parseTokens(n,{hash:()=>t.hash,"project.remote":()=>c,"project.name":()=>i});if(f.isUrl(u))return s.Uri.parse(u);if(""===u&&e){const e=this.isToolUrlPlural(o);if(o){const r=this.defaultWebPath(o,t.hash,e);return s.Uri.parse(r)}}else s.window.showErrorMessage("Malformed URL in gitblame.commitUrl. "+`Currently expands to: '${u}'`)}updateView(t){t.generated?this.clearView():this.statusBarView.update(t)}clearView(){this.statusBarView.clear()}async getCurrentLineInfo(){return void 0===s.window.activeTextEditor?g.blankCommitInfo():this.blame.blameLine(s.window.activeTextEditor.document,s.window.activeTextEditor.selection.active.line)}isToolUrlPlural(t){if(!0===a.container.resolve(h.Property).get("isWebPathPlural"))return!0;const e=a.container.resolve(h.Property).get("pluralWebPathSubstrings");return void 0!==e&&e.some(e=>t.includes(e))}};n([d.throttleFunction(16),p.runNextTick(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],b.prototype,"onTextEditorMove",null),b=n([a.injectable(),o("design:paramtypes",[_.GitBlame,y.StatusBarView])],b),e.GitExtension=b},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s};Object.defineProperty(e,"__esModule",{value:!0});let o=class{constructor(){this.title="NO_TITLE",this.action=()=>{}}setTitle(t){this.title=t}setAction(t){this.action=t}takeAction(){this.action&&this.action()}};o=n([r(0).injectable()],o),e.ActionableMessageItem=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(7);e.isUrl=function(t){let e;try{e=new n.URL(t)}catch(t){return!1}return e.href===t&&("http:"===e.protocol||"https:"===e.protocol)&&""!==e.hostname&&""!==e.pathname}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.runNextTick=function(){return(t,e,r)=>{if(void 0===r.value)throw new Error("Invalid runNextTick usage detected");const n=r.value;r.value=function(...t){return new Promise(e=>{setImmediate(()=>{e(n.call(this,t))})})}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pluralText=function(t,e,r){return 1===t?`${t} ${e}`:`${t} ${r}`}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=1e3,o=60*n,i=60*o,s=24*i,a=30.4375*s,c=365.25*s;function u(t,e,r){const n=e.valueOf()-r.valueOf();return Math.round(n/t)}e.secondsBetween=function(t,e){return u(n,t,e)},e.minutesBetween=function(t,e){return u(o,t,e)},e.hoursBetween=function(t,e){return u(i,t,e)},e.daysBetween=function(t,e){return u(s,t,e)},e.monthsBetween=function(t,e){return u(a,t,e)},e.yearsBetween=function(t,e){return u(c,t,e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=new Set;e.throttleFunction=function(t){return(e,r,o)=>{if(void 0===o.value)throw new Error("Invalid trottleFunction usage detected");const i=o.value,s=Symbol();o.value=function(...e){return n.has(s)||(i.call(this,e),n.add(s),setTimeout(()=>{n.delete(s)},t)),Promise.resolve()}}}},function(t,e){t.exports=require("path")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.validEditor=function(t){const e=t&&t.document;return!!e&&!e.isUntitled}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(10),o=r(3),i=r(0);e.execute=function(t,e,r={}){return new Promise(s=>{i.container.resolve(o.ErrorHandler).logCommand(`${t} ${e.join(" ")}`),n.execFile(t,e,r,function(t,e){return(r,n,s)=>{if(r){if("ENOENT"===r.code){const n=`${t}: No such file or directory. (ENOENT)`;return i.container.resolve(o.ErrorHandler).logCritical(r,n),void e("")}i.container.resolve(o.ErrorHandler).logError(new Error(s)),e("")}else e(n)}}(t,s))})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.stripGitRemoteUrl=function(t){return t.replace(/^[a-z-]+:\/\//i,"").replace(/:([a-z_.~+%-][a-z0-9_.~+%-]+)\/?/i,"/$1/").replace(/\.git$/i,"")}},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const i=r(0),s=r(2),a=r(26);let c=class{constructor(t){this.files=new Map,this.factory=t}async blameLine(t,e){const r=e+1,n=await this.getBlameInfo(t);if(void 0===n)return s.blankCommitInfo();const o=n.lines[r];return void 0===o?s.blankCommitInfo():n.commits[o]}async removeDocument(t){const e=await this.files.get(t);void 0!==e&&(this.files.delete(t),e.dispose())}dispose(){this.files.forEach(async(t,e)=>{this.removeDocument(e)})}async getBlameInfo(t){this.files.has(t)||this.files.set(t,this.factory.create(t));const e=await this.files.get(t);if(void 0!==e)return e.blame()}};c=n([i.injectable(),o("design:paramtypes",[a.GitFileFactory])],c),e.GitBlame=c},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s};Object.defineProperty(e,"__esModule",{value:!0});const o=r(11),i=r(1),s=r(0),a=r(27),c=r(28),u=r(6);let l=class{async create(t){return this.inWorkspace(t.fileName)&&await this.exists(t.fileName)&&await this.inGitWorktree(t.fileName)?new c.GitFilePhysical(t.fileName):new a.GitFileDummy(t.fileName)}inWorkspace(t){const e=i.Uri.file(t);return void 0!==i.workspace.getWorkspaceFolder(e)}exists(t){return new Promise(e=>{o.access(t,t=>{e(!t)})})}async inGitWorktree(t){return""!==await u.getWorkTree(t)}};l=n([s.injectable()],l),e.GitFileFactory=l},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const i=r(0),s=r(3),a=r(2);let c=class{constructor(t){i.container.resolve(s.ErrorHandler).logInfo(`Will not try to blame file "${t}" as it is outside of the current workspace`)}async blame(){return a.blankBlameInfo()}dispose(){}};c=n([i.injectable(),o("design:paramtypes",[String])],c),e.GitFileDummy=c},function(t,e,r){"use strict";var n=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const i=r(11),s=r(3),a=r(9),c=r(29),u=r(2),l=r(0);let f=class{constructor(t){this.fileName=t,this.fileSystemWatcher=this.setupWatcher()}async blame(){return l.container.resolve(a.StatusBarView).startProgress(),this.blameInfoPromise?this.blameInfoPromise:this.findBlameInfo()}dispose(){this.blameProcess&&(this.blameProcess.terminate(),delete this.blameProcess),this.fileSystemWatcher.close()}setupWatcher(){return i.watch(this.fileName,t=>{"rename"===t?this.dispose():"change"===t&&this.changed()})}changed(){delete this.blameInfoPromise}async findBlameInfo(){return l.container.resolve(a.StatusBarView).startProgress(),this.blameInfoPromise=new Promise(t=>{const e=u.blankBlameInfo();this.blameProcess=l.container.resolve(c.GitBlameStream),this.blameProcess.blame(this.fileName),this.blameProcess.on("commit",this.gitAddCommit(e)),this.blameProcess.on("line",this.gitAddLine(e)),this.blameProcess.on("end",this.gitStreamOver(this.blameProcess,t,e))}),this.blameInfoPromise}gitAddCommit(t){return(e,r)=>{t.commits[e]=r}}gitAddLine(t){return(e,r)=>{t.lines[e]=r}}gitStreamOver(t,e,r){return n=>{t.removeAllListeners(),n?(l.container.resolve(s.ErrorHandler).logError(n),e(u.blankBlameInfo())):(l.container.resolve(s.ErrorHandler).logInfo(`Blamed file "${this.fileName}" and found ${Object.keys(r.commits).length} commits`),e(r))}}};f=n([l.injectable(),o("design:paramtypes",[String])],f),e.GitFilePhysical=f},function(t,e,r){"use strict";var n,o=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},i=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});const s=r(30),a=r(0),c=r(6),u=r(2);let l=n=class extends s.EventEmitter{constructor(){super(),this.emittedCommits=new Set}blame(t){this.process=c.spawnGitBlameStreamProcess(t),this.setupListeners()}terminate(){this.dispose()}dispose(){void 0!==this.process&&(this.process.kill("SIGTERM"),this.process.removeAllListeners())}setupListeners(){void 0!==this.process&&(this.process.addListener("close",()=>this.close()),this.process.stdout.addListener("data",t=>{this.data(t.toString())}),this.process.stderr.addListener("data",t=>{this.close(t)}))}close(t){this.emit("end",t)}data(t){const e=t.split("\n");let r=u.blankCommitInfo();e.forEach((t,o)=>{if(t&&"boundary"!==t){const i=t.match(/(.*?) (.*)/);if(null===i)return;const[,s,a]=Array.from(i);n.HASH_PATTERN.test(s)&&e.hasOwnProperty(o+1)&&/^(author|committer)/.test(e[o+1])&&""!==r.hash&&(this.commitInfoToCommitEmit(r),r=u.blankCommitInfo(!0)),this.processLine(s,a,r)}}),this.commitInfoToCommitEmit(r)}processLine(t,e,r){const[o,i]=t.split("-");let s={mail:"",name:"",temporary:!0,timestamp:0,tz:""};if("author"===o?s=r.author:"committer"===o&&(s=r.committer),s.temporary||i){if("mail"===i)s.mail=e;else if("time"===i)s.timestamp=parseInt(e,10);else if("tz"===i)s.tz=e;else if("summary"===t)r.summary=e;else if(n.HASH_PATTERN.test(t)){r.hash=t;const n=t,[,o,i]=e.split(" ").map(t=>parseInt(t,10));this.lineGroupToLineEmit(n,i,o)}}else s.name=e}lineGroupToLineEmit(t,e,r){for(let n=0;n<e;n++)this.emit("line",r+n,t)}commitInfoToCommitEmit(t){this.emittedCommits.has(t.hash)||(this.emittedCommits.add(t.hash),this.emit("commit",t.hash,t))}};l.HASH_PATTERN=/[a-z0-9]{40}/,l=n=o([a.injectable(),i("design:paramtypes",[])],l),e.GitBlameStream=l},function(t,e){t.exports=require("events")}]);